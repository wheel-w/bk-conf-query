(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{100:function(t,e,i){},101:function(t,e,i){},112:function(t,e,i){"use strict";var s=i(99);var a=i.n(s);var n=a.a},113:function(t,e,i){"use strict";var s=i(100);var a=i.n(s);var n=a.a},114:function(t,e,i){"use strict";var s=i(101);var a=i.n(s);var n=a.a},119:function(t,e,i){"use strict";var s=function(){var t=this;var e=t.$createElement;var i=t._self._c||e;return i("div",{staticStyle:{height:"100%"}},[!t.isBizAuth?i("bk-exception",{staticClass:"exception-wrap-item",attrs:{type:"403"}},[i("span",[t._v(t._s(t.$t("无业务权限")))]),t._v(" "),i("div",{staticClass:"text-subtitle"},[t._v(t._s(t.$t("你没有相应业务的访问权限，请前往申请相关业务权限")))]),t._v(" "),i("div",{staticClass:"text-wrap"},[i("span",{staticClass:"text-btn",on:{click:t.applyBizAuth}},[t._v(t._s(t.$t("去申请")))])])]):t._e(),t._v(" "),t.isBizAuth?i("div",{staticClass:"host-sea-content"},[i("div",{staticClass:"my-dialog"},[i("bk-dialog",{attrs:{fullscreen:true,"show-footer":true,"render-directive":"if"},model:{value:t.treeVisible,callback:function(e){t.treeVisible=e},expression:"treeVisible"}},[i("div",[i("bk-tab",{staticStyle:{"margin-top":"20px"},attrs:{active:t.active,type:t.currentType},on:{"update:active":function(e){t.active=e}}},[t._l(t.panels,function(e,s){return i("bk-tab-panel",t._b({key:s},"bk-tab-panel",e,false))}),t._v(" "),t.active==="ipSelect"?i("div",{staticStyle:{height:"calc(100vh - 350px)",display:"flex",width:"calc(80vw - 200px)"}},[i("div",{staticClass:"my-tree"},[i("div",{staticStyle:{"text-align":"center"}},[i("bk-button",{staticClass:"mr10",staticStyle:{width:"80%"},attrs:{theme:"default",type:"submit"},on:{click:t.handleReset}},[t._v("\n                                        "+t._s(t.$t("重置"))+"\n                                    ")])],1),t._v(" "),i("section",{staticStyle:{"margin-top":"15px"}},[i("bk-big-tree",{ref:"tree",attrs:{selectable:true,data:t.treeData,"node-icon":"bk-icon icon-rtx",padding:30},on:{"select-change":t.treeDataChange}})],1)]),t._v(" "),i("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading,zIndex:10},expression:"{ isLoading: isDataLoading , zIndex: 10 }"}],staticClass:"my-host-table"},[i("div",{staticClass:"my-host-table-content"},[i("bk-table",{ref:"hostTable",attrs:{data:t.data,"max-height":"calc(100vh - 450px)",height:"calc(100vh - 450px)",pagination:t.pagination,"row-key":t.getRowKeys},on:{"selection-change":t.selectHost,"page-change":t.handlePageChange,"page-limit-change":t.handleLimitChange}},[i("bk-table-column",{attrs:{type:"selection","reserve-selection":true,width:"60",selectable:t.selectable}}),t._v(" "),i("bk-table-column",{attrs:{type:"index",label:t.$t("序列"),width:"70",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机ID"),prop:"bk_host_id",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机名称"),prop:"bk_host_name",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("内网IP"),prop:"bk_host_innerip",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("外网IP"),prop:"bk_host_outerip",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("云区域"),prop:"bk_cloud_name",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机类型"),prop:"host_system",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("操作"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[!e.row.is_auth?i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:""},on:{click:function(i){t.applyAuth(e.row)}}},[t._v(t._s(t.$t("权限申请")))]):t._e()]}}])})],1)],1)])]):t._e(),t._v(" "),t.active==="ipInput"?i("div",{staticStyle:{height:"calc(100vh - 350px)",display:"flex",width:"calc(80vw - 200px)"}},[i("bk-input",{attrs:{placeholder:t.ipInputPlaceholder,type:"textarea"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1):t._e()],2)],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("span",{staticClass:"select-items"},[t._v(t._s(t.$t("已选择"))+":  "),i("span",{staticClass:"strong number choose-host"},[t._v(t._s(t.multipleSelection.length))]),t._v(t._s(t.$t("台主机")))]),t._v(" "),i("bk-button",{staticClass:"mr50",attrs:{theme:"primary",title:"主要按钮"},on:{click:t.doSeclectHosts}},[t._v("\n                        "+t._s(t.$t("确认添加"))+"\n                    ")])],1)])],1),t._v(" "),i("div",{staticClass:"my-form"},[i("bk-form",{attrs:{"label-width":120,model:t.formData}},[i("bk-form-item",{attrs:{label:t.$t("业务"),required:true}},[i("bk-select",{attrs:{searchable:"",placeholder:t.$t("请选择业务"),"search-with-pinyin":true},on:{change:t.businessChange},model:{value:t.bkBizId,callback:function(e){t.bkBizId=e},expression:"bkBizId"}},t._l(t.businessList,function(e){return i("bk-option",{key:e.bk_biz_id,attrs:{id:e.bk_biz_id,name:e.bk_biz_name}},[t._v("\n                            "+t._s(e.bk_biz_name)+"\n                            "),!e.is_auth?i("i",{staticClass:"bk-icon icon-lock"}):t._e()])}),1)],1),t._v(" "),i("bk-form-item",{attrs:{label:t.$t("目标主机"),required:true,property:"name"}},[i("bk-button",{staticClass:"mr10",attrs:{theme:"primarydefault",type:"submit"},on:{click:t.addHosts}},[t._v("\n                        "+t._s(t.$t("添加服务器"))+"\n                    ")]),t._v(" "),i("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:"主要按钮"},on:{click:t.clearHosts}},[t._v("\n                        "+t._s(t.$t("清空"))+"\n                    ")]),t._v(" "),i("bk-table",{staticStyle:{"margin-top":"15px"},attrs:{data:t.selectData,"max-height":"calc(100vh - 600px)",height:"calc(100vh - 600px)"}},[i("bk-table-column",{attrs:{type:"index",label:t.$t("序列"),width:"70",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机IP"),prop:"bk_host_innerip",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("云区域"),prop:"bk_cloud_name",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机名称"),prop:"bk_host_name",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机类型"),prop:"host_system",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("操作"),align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(i){t.remove(e.row)}}},[t._v(t._s(t.$t("移除")))])]}}])})],1)],1),t._v(" "),i("bk-form-item",{attrs:{label:t.$t("主机类型"),required:true}},[i("bk-radio-group",{model:{value:t.osType,callback:function(e){t.osType=e},expression:"osType"}},[i("bk-radio",{attrs:{value:0}},[t._v("linux")]),t._v(" "),i("bk-radio",{attrs:{value:1}},[t._v("windows")])],1)],1),t._v(" "),i("bk-form-item",{attrs:{label:t.$t("目录"),required:true}},[i("bk-input",{model:{value:t.formData.file_path,callback:function(e){t.$set(t.formData,"file_path",e)},expression:"formData.file_path"}})],1),t._v(" "),i("bk-form-item",{attrs:{label:t.$t("文件后缀"),required:true}},[i("bk-input",{model:{value:t.formData.file_suffix1,callback:function(e){t.$set(t.formData,"file_suffix1",e)},expression:"formData.file_suffix1"}})],1),t._v(" "),i("bk-form-item",[i("bk-button",{staticStyle:{"margin-right":"3px"},attrs:{theme:"primary",title:"提交",loading:t.isSearch},on:{click:function(e){e.stopPropagation();e.preventDefault();return t.searchHostFiles(e)}}},[t._v(t._s(t.$t("查询")))]),t._v(" "),t.isError?i("bk-button",{staticStyle:{"margin-left":"30px"},attrs:{theme:"warning",title:"提交"},on:{click:function(e){t.isShowErrInfo=true}}},[t._v(t._s(t.$t("查看异常信息")))]):t._e()],1)],1),t._v(" "),i("div",{staticClass:"my-step"},[i("bk-process",{staticStyle:{"pointer-events":"none"},attrs:{list:t.loadingList,"cur-process":t.loadingProcess,"display-key":"content","show-steps":false,controllable:false},on:{"update:curProcess":function(e){t.loadingProcess=e}}})],1)],1),t._v(" "),i("div",{staticClass:"my-search-result"},[i("div",{staticStyle:{"margin-top":"30px","margin-left":"20px"}},[i("bk-table",{attrs:{data:t.resultData,"max-height":"calc(100vh - 450px)",height:"calc(100vh - 450px)"}},[i("bk-table-column",{attrs:{type:"expand",width:"30"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("bk-table",{attrs:{data:e.row.file_list.split(","),"outer-border":false,"show-header":false,"header-cell-style":{background:"#fff",borderRight:"none"}}},[i("bk-table-column",{attrs:{align:"center","show-overflow-tooltip":true},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticStyle:{"text-align":"center"}},[t._v(t._s(e.row))])]}}])})],1)]}}])}),t._v(" "),i("bk-table-column",{attrs:{type:"index",label:t.$t("序列"),width:"70",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("主机IP"),prop:"ip.ip",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("文件目录"),prop:"file_directory",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("文件列表"),prop:"file_list",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("文件大小"),prop:"file_size",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                            "+t._s(t.byteConvert(e.row.file_size))+"\n                        ")]}}])}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("文件数量"),prop:"file_count",align:"center"}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("操作"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("bk-button",{staticClass:"mr10",attrs:{theme:"primary",text:"",disabled:e.row.isBackup||e.row.file_count===0},on:{click:function(i){t.backupFile(e.row)}}},[t._v(t._s(t.$t("立即备份")))])]}}])})],1)],1)]),t._v(" "),i("bk-sideslider",{attrs:{"is-show":t.isShowErrInfo,"quick-close":true,"show-mask":false,width:500,transfer:true},on:{"update:isShow":function(e){t.isShowErrInfo=e}}},[i("div",{attrs:{slot:"header"},slot:"header"},[t._v(t._s(t.$t("错误详情")))]),t._v(" "),i("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},t._l(t.errInfo,function(e,s){return i("div",{key:s},[i("bk-alert",{staticStyle:{margin:"10px"},attrs:{type:"error"}},[i("div",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(t.$t(e.ip))+" : "+t._s(e.err_msg))])])],1)}),0)])],1):t._e()],1)};var a=[];i.d(e,"a",function(){return s});i.d(e,"b",function(){return a})},87:function(t,e,i){"use strict";i.r(e);var s=i(119);var a=i(97);for(var n in a)if(n!=="default")(function(t){i.d(e,t,function(){return a[t]})})(n);var l=i(112);var r=i(113);var o=i(114);var c=i(2);var u=Object(c["a"])(a["default"],s["a"],s["b"],false,null,"69f77620",null);e["default"]=u.exports},97:function(t,e,i){"use strict";i.r(e);var s=i(98);var a=i.n(s);for(var n in s)if(n!=="default")(function(t){i.d(e,t,function(){return s[t]})})(n);e["default"]=a.a},98:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;var s={components:{},data:function t(){return{ipInputPlaceholder:"请输入IP地址,多个IP请使用 , 或者换行分隔。\n带云区域请使用:分隔,如(0:192.168.0.1)",bkBizId:"",bkSetId:"",bkModuleId:"",businessList:"",multipleSelection:[],osType:0,isBizAuth:true,isDataLoading:false,curBusiness:{},loadingProcess:1,isSearch:false,interval:null,isError:false,isShowErrInfo:false,errInfo:[],loadingList:[{content:this.$t("表单填写"),isLoading:true},{content:this.$t("查询"),isLoading:true},{content:this.$t("结束")}],filterCondition:{},treeVisible:false,treeData:[],data:[],selectData:[],resultData:[],pagination:{current:1,count:100,limit:20},formData:{},panels:[{name:"ipSelect",label:this.$t("静态-IP选择"),count:10}],active:"ipSelect",type:["card","border-card","unborder-card","vertical-card"],currentType:"card"}},methods:{fetchPageData:function t(){var e=this;this.$http.get("/api/business/").then(function(t){e.businessList=t.data;e.isBizAuth=e.businessList[0].is_auth})},applyBizAuth:function t(){window.open("https://bkiam.paas-edu.bktencent.com/")},byteConvert:function t(e){if(isNaN(e)){return""}var i=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"];var s=Math.floor(Math.log(e)/Math.log(2));if(s<1){s=0}var a=Math.floor(s/10);e=e/Math.pow(2,10*a);if(e.toString().length>e.toFixed(2).toString().length){e=e.toFixed(2)}return e+" "+i[a]},applyAuth:function t(e){this.$http.get("/api/make_host_apply_url/".concat(e.bk_biz_id.replace(",",""),"/").concat(e.bk_set_id.split(",")[0],"/").concat(e.bk_module_id.split(",")[0],"/").concat(e.bk_host_id,"/")).then(function(t){window.open(t.data)})},selectable:function t(e,i){return e.is_auth},handleReset:function t(){this.bkSetId=null;this.bkModuleId=null;this.multipleSelection=this.selectData;this.pagination.current=1;this.get_filter_hosts();this.get_sets_of_business()},doSeclectHosts:function t(){this.selectData=this.multipleSelection;this.treeVisible=false},businessChange:function t(e){var i=this;this.businessList.forEach(function(t){if(t.bk_biz_id===e){i.curBusiness=t}});this.bkSetId=null;this.bkModuleId=null;this.selectData=[];this.formData={};this.resultData=[];this.loadingProcess=1;this.isError=false;this.isSearch=false;clearInterval(this.interval);this.get_sets_of_business();this.pagination.current=1;this.get_filter_hosts()},addHosts:function t(){if(!this.bkBizId){this.$bkMessage({theme:"warning",message:this.$t("请先选择业务"),offset:"80"});return}this.bkSetId=null;this.bkModuleId=null;this.multipleSelection=this.selectData;this.pagination.current=1;this.get_filter_hosts();this.treeVisible=true},rowMultipleChecked:function t(){var e=this;this.multipleSelection.forEach(function(t){e.data.forEach(function(i){if(i.bk_host_id===t.bk_host_id){e.$refs.hostTable.toggleRowSelection(i,true)}})})},clearHosts:function t(){this.selectData=[]},selectHost:function t(e){var i=this;this.multipleSelection=this.arrayNonRepeatfy(this.multipleSelection.concat(e));var s=[];this.data.forEach(function(t){s.push(t.bk_host_id)});var a=[];this.multipleSelection.forEach(function(t){a.push(t.bk_host_id)});var n=[];e.forEach(function(t){n.push(t.bk_host_id)});s.forEach(function(t){var e=a.indexOf(t);if(e!==-1&&n.indexOf(t)===-1){i.multipleSelection[e]=""}});this.multipleSelection=this.multipleSelection.filter(function(t){return t!==""})},getRowKeys:function t(e){return e.bk_host_id},remove:function t(e){var i=this.selectData.indexOf(e);if(i!==-1){this.selectData.splice(i,1)}},backupFile:function t(e){var i=this;e.isBackup=true;var s={bk_biz_id:this.bkBizId,ip_list:[e.ip],file_suffix:this.formData.file_suffix1,file_list:e.file_list.split(","),file_directory:e.file_directory,os_type:e.os_type};this.$http.post("/api/backup_host_files/",s).then(function(t){if(t.result){i.$bkMessage({theme:"success",message:i.$t("开始备份"),offset:"80"})}else{i.$bkMessage({theme:"warning",message:i.$t("该目录禁止备份"),offset:"80"})}})},searchHostFiles:function t(){var e=this;this.formData.bk_biz_id=this.bkBizId;this.formData.os_type=this.osType;this.formData.ip_list=[];this.selectData.forEach(function(t){e.formData.ip_list.push({ip:t.bk_host_innerip,bk_cloud_id:t.bk_cloud_id})});if(!this.bkBizId){this.$bkMessage({theme:"warning",message:this.$t("请先选择业务"),offset:"80"});return}if(this.formData.ip_list.length===0){this.$bkMessage({theme:"warning",message:this.$t("请至少选择一台主机"),offset:"80"});return}if(!this.formData.file_path){this.$bkMessage({theme:"warning",message:this.$t("请输入文件目录"),offset:"80"});return}if(this.formData.file_path.indexOf("\\")!==-1){this.$bkMessage({theme:"warning",message:this.$t("windows和linux文件分隔符请使用/"),offset:"80"});return}if(!this.formData.file_suffix1){this.$bkMessage({theme:"warning",message:this.$t("请输入文件后缀"),offset:"80"});return}if(this.formData.file_suffix1===".*"){this.formData.file_suffix="''"}else{this.formData.file_suffix=this.formData.file_suffix1}this.isSearch=true;this.isError=false;this.errInfo=[];this.resultData=[];this.$http.post("/api/search_host_files/",this.formData).then(function(t){e.loadingProcess=2;var i=0;e.interval=setInterval(function(){e.$http.get("/api/search_host_files_result/".concat(t.data,"/")).then(function(t){i++;if(i>=100){clearInterval(e.interval)}if(t.result){if(t.data.fail_host_info.length!==0){e.isError=true;e.errInfo=t.data.fail_host_info}t.data.file_list.forEach(function(t){t.isBackup=false;e.resultData.push(t)});e.loadingProcess=4;e.isSearch=false;clearInterval(e.interval);e.$bkMessage({theme:"primary",message:e.resultData.length+e.$t("台成功/")+e.errInfo.length+e.$t("台失败"),offset:"80"})}})},2e3)})},treeDataChange:function t(e){var i=this;if(e.level===0){this.bkSetId=e.id;this.bkModuleId=null;this.pagination.current=1;this.get_filter_hosts();this.$http.get("/api/modules_of_set/".concat(this.bkBizId,"/").concat(e.id,"/")).then(function(t){var s=t.data;var a=i.$refs.tree.getNodeById(e.id);if(a.children.length===0){i.$refs.tree.addNode(s,e.id)}})}if(e.level===1){i.bkModuleId=e.data.bk_module_id;i.bkSetId=e.parent.id;this.pagination.current=1;i.get_modules_of_set();i.get_filter_hosts()}},arrayNonRepeatfy:function t(e){var i=new Map;var s=[];for(var a=0;a<e.length;a++){if(i.has(e[a].bk_host_id)){i.set(e[a].bk_host_id,true)}else{i.set(e[a].bk_host_id,false);s.push(e[a])}}return s},handlePageChange:function t(e){this.pagination.current=e;this.get_filter_hosts()},handleLimitChange:function t(e){this.pagination.limit=e;this.pagination.current=1;this.get_filter_hosts()},get_business_info:function t(){var e=this;this.$http.get("/api/business/").then(function(t){e.businessList=t.data})},get_sets_of_business:function t(){var e=this;this.$store.commit("setCurBusiness",this.curBusiness);this.$http.get("/api/sets_of_business/".concat(this.bkBizId,"/")).then(function(t){e.treeData=t.data;e.setList=t.data})},get_modules_of_set:function t(){var e=this;this.$http.get("/api/modules_of_set/".concat(this.filterCondition.bk_biz_id,"/").concat(this.filterCondition.bk_set_id,"/")).then(function(t){e.moduleList=t.data})},get_filter_hosts:function t(){var e=this;this.filterCondition.bk_biz_id=this.bkBizId;this.filterCondition.bk_set_id=this.bkSetId;this.filterCondition.bk_module_id=this.bkModuleId;this.filterCondition.start=(this.pagination.current-1)*this.pagination.limit;this.filterCondition.limit=this.pagination.limit;this.data=[];this.isDataLoading=true;this.$store.commit("setCurBusiness",this.curBusiness);this.$http.post("/api/filter_hosts/?start=".concat(this.filterCondition.start,"&limit=").concat(this.pagination.limit),this.filterCondition).then(function(t){if(t.code!==403){e.pagination.count=t.count;e.data=t.data;setTimeout(e.rowMultipleChecked(),500)}e.isDataLoading=false})}}};e.default=s},99:function(t,e,i){}}]);